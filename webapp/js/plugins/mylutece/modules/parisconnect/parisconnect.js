// displayLoginPagePopupfunction displayLoginPagePopup() {	baseUrl = document.getElementsByTagName('base')[0].href;	currentUrl = window.location.href;    returnUrl = jQuery.isEmptyObject(currentUrl) ? baseUrl : currentUrl;    returnUrl = addParameter(returnUrl,'checkUserInformations','check');    return displayLoginPagePopupWithBackUrl(returnUrl);}// displayLoginPagePopupfunction displayLoginPagePopupWithBackUrl(returnUrl) {	window.open( popupConnectLoginPageUrl + returnUrl, '_blank', 'width=720,height=812,scrollbars=yes,status=yes,resizable=yes,screenx=0,screeny=0');    return false;}// displayLostPasswordPagePopupfunction displayLostPasswordPagePopup() {		baseUrl = document.getElementsByTagName('base')[0].href;	urlPrefix = "https://accounts.paris.fr/account/send_password?pop=1&returnUrl=";	currentUrl = window.location.href;	returnUrl = jQuery.isEmptyObject(currentUrl) ? baseUrl : currentUrl;	window.open( urlPrefix + returnUrl , '_blank', 'width=720,height=812,scrollbars=yes,status=yes,resizable=yes,screenx=0,screeny=0');    return false;}$(document).ready( function(){	 baseUrl = document.getElementsByTagName('base')[0].href;    // Ajax Login authentication    $(".btn-connexion").click(    function () {        var userInfos = {            username: $("#username").val(),            password: $("#password").val(),            token:$("#token").val()        };        var urlDoLogin = baseUrl + "jsp/site/plugins/mylutece/modules/parisconnect/DoLoginJson.jsp";        $.ajax({            url: urlDoLogin,            type: "POST",            dataType: "json",            data: userInfos,            async: false,        	cache:false,            success: function (data) {                if (data.status == 'OK') {                    if (data.result) {                        $("#login_error").hide();                        location.reload();                    } else {                        $("#login_error").show();                    }                }                else if ( data.status == 'ERROR' && ( data.errorCode == 'TOKEN_NOT_VALIDATED'||data.errorCode == 'LOGIN_ERROR') )                {                	$("#token").val(data.token);                	$("#login_error").show();                	                }            },            error: function (jqXHR, textStatus, errorThrown) {            }        });        return false;    });        $("#lost_password").hide();	    $("#username").click(function(){		$("#login_error").hide();	});       $("#password").click(function(){		$("#login_error").hide();	});				$( "#password").focus(function() {		$("#lost_password").show();	});		$("#lost_password").click( function(){		displayLostPasswordPagePopup();		$(this).hide();		return false;	});	});// checked if the user is authenticatedfunction checkIfUserIsAuthenticated() {    var result = false;    baseUrl = document.getElementsByTagName('base')[0].href;    $.ajax({        url: baseUrl + 'jsp/site/plugins/mylutece/modules/parisconnect/IsUserAuthenticatedJson.jsp',        type: 'GET',        dataType: "json",        data: {},        async: false,    	cache:false,        success: function (data) {            if (data.status == 'OK') {                result = data.result;            }        },        error: function (jqXHR, textStatus, errorThrown) {        }    });    return result;}function addParameter(uri, key, value) {	  var re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");	  var separator = uri.indexOf('?') !== -1 ? "&" : "?";	  if (uri.match(re)) {	    return uri.replace(re, '$1' + key + "=" + value + '$2');	  }	  else {	    return uri + separator + key + "=" + value;	  }	}function  addControlOnFormAlert(){	baseUrl = document.getElementsByTagName('base')[0].href;	$("#form-alert .messages_errors_div_text").hide();	$("#form-alert .messages_infos_div_text").hide();	$( "#email-alert" ).focus(function() {		$("#form-alert .messages_errors_div_text").hide();		$("#form-alert .messages_infos_div_text").hide();		});		$("#form-alert").submit(function(e)	{			$("#form-alert .messages_errors_div_text").hide();		$("#form-alert .messages_infos_div_text").hide();		var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;		var mailAlert=$("#email-alert").val();		var token= $("#token-form-alert").val();		if(mailAlert=='')		{			$("#form-alert .messages_errors_div_text").html('Veuillez saisir une adresse email');	    	$("#form-alert .messages_errors_div_text").show();	    	    }			else if(!emailReg.test(mailAlert))		{				$("#form-alert .messages_errors_div_text").html('Veuillez saisir une adresse email valide');			$("#form-alert .messages_errors_div_text").show();			}		else		{		    	var postData = {mail: mailAlert,token:token};	    	$("#btn-submit-alert").button('loading');	    	$.ajax(	    	{		    	url : baseUrl + "jsp/site/plugins/mylutece/modules/parisconnect/DoSubscribeAlert.jsp",			    type: "POST",			    data : postData,			    dataType: "json",			    async: false,			    cache:false,			    success:function(data, textStatus, jqXHR) 			    {			    	if ( data.status == 'OK' )		    		{					       if ( data.result.success )						{				        		$("#form-alert .messages_infos_div_text").html("Vous êtes maintenant inscrit à l'alerte Paris Connect");			        		$("#form-alert .messages_infos_div_text").show();			        		$("#token-form-alert").val(data.result.token);							}		    		}					else if(data.errorCode =='ERROR_USER_ALREADY_SUBSCRIBED')					{							$("#form-alert .messages_errors_div_text").html("Vous êtes déja inscrit à cette alerte");							$("#form-alert .messages_errors_div_text").show();							$("#token-form-alert").val(data.token);					}					else					{						$("#form-alert .messages_errors_div_text").html("Une erreur est survenue lors de l'inscription à l'alerte");						$("#form-alert .messages_errors_div_text").show();						$("#token-form-alert").val(data.token);					}		        	$("#btn-submit-alert").button('reset');			        },			        error: function(jqXHR, textStatus, errorThrown) 		        {		        }			    });			   }			return false;		});	}// form-mibfunction  addControlOnFormMib(){	baseUrl = document.getElementsByTagName('base')[0].href;	$("#form-mib .messages_errors_div_text").hide();	$("#form-mib .messages_infos_div_text").hide();	$( "#email-mib" ).focus(function() {	$("#form-mib .messages_errors_div_text").hide();	$("#form-mib .messages_infos_div_text").hide();	});	$( "#message-mib" ).focus(function() {		$("#form-mib .messages_errors_div_text").hide();		$("#form-mib .messages_infos_div_text").hide();	});			$("#form-mib").submit(function(e)	{		$("#form-mib .messages_errors_div_text").hide();		$("#form-mib .messages_infos_div_text").hide();		var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;		var mail=$("#email-mib").val();		var message=$("#message-mib").val();		var token= $("#token-form-mib").val();		if(message =='' )	    {	    	$("#form-mib .messages_errors_message").html('Veuillez saisir un message');	    	$("#form-mib .messages_errors_message").show();	    	return false;	    }		else if(mail!='' && !emailReg.test(mail))			{			$("#form-mib .messages_errors_mail").html('Veuillez saisir une adresse email valide');	    	$("#form-mib .messages_errors_mail").show();	    	return false;		}		else		{			var postData = {mail: mail,message:message,token:token};			$("#btn-submit-mib").button('loading');		  	$.ajax({				    url : baseUrl + "jsp/site/plugins/mylutece/modules/parisconnect/DoSendAvis.jsp",					type: "POST",			        data : postData,			        dataType: "json",			        async: false,			        cache:false,			        success:function(data, textStatus, jqXHR) 			        {			        	if ( data.status == 'OK' )			    		{					        	if ( data.result.success )							{				        		$("#form-mib .messages_infos_div_text").html("Votre message a été envoyé");				        		$("#form-mib .messages_infos_div_text").show();				        		$("#token-form-mib").val(data.result.token);							}					    	}						else						{							$("#form-mib .messages_errors_mail").html("Une erreur est survenue lors de l'envoi de votre message");							$("#form-mib .messages_errors_mail").show();							$("#token-form-mib").val(data.token);							}				        $("#btn-submit-mib").button('reset');				       },			       error: function(jqXHR, textStatus, errorThrown) 				   	{ 			    	   				   	}		  			});			}							return false;		});}//form-mibfunction  addControlOnFormAvis(){	baseUrl = document.getElementsByTagName('base')[0].href;	$("#form-avis .messages_errors_div_text").hide();	$("#form-avis .messages_infos_div_text").hide();	$( "#message-avis" ).focus(function() {		$("#form-avis .messages_errors_div_text").hide();		$("#form-avis .messages_infos_div_text").hide();	});	$("#form-avis").submit(function(e)	{		$("#form-avis .messages_errors_div_text").hide();		$("#form-avis .messages_infos_div_text").hide();		var message=$("#message-avis").val();		var mail=$("#email-avis").val();		var token= $("#token-form-avis").val();		if(message =='' )	    {	    	$("#form-avis .messages_errors_div_text").html('Veuillez saisir un message');	    	$("#form-avis .messages_errors_div_text").show();	    	return false;	    }			$("#btn-submit-avis ").button('loading');		var postData = {mail: mail,message:message,token:token};	  	$.ajax(			    {			    	url : baseUrl + "jsp/site/plugins/mylutece/modules/parisconnect/DoSendAvis.jsp",			        type: "POST",			        data : postData,			        dataType: "json",			        async: false,			        cache:false,			        success:function(data, textStatus, jqXHR) 			        {			        	if ( data.status == 'OK' )			    		{					        	if ( data.result.success )							{				        		$("#form-avis .messages_infos_div_text").html("Votre message a été envoyé");				        		$("#form-avis .messages_infos_div_text").show();				        		$("#token-form-avis").val(data.result.token);							}			    		}						else						{							$("#form-avis .messages_errors_div_text").html("Une erreur est survenue lors de l'envoi de votre message");							$("#form-avis .messages_errors_div_text").show();							$("#token-form-avis").val(data.token);						}	        				        	$("#btn-submit-avis").button('reset');					        },			        error: function(jqXHR, textStatus, errorThrown) 			        {	             			        }			    });		 	return false;		});}